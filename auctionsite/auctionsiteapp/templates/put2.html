{% extends 'base.html' %}

{% block content %}
<h1>Django Image Uploading</h1>

<body>
  <div class="container pt-5">
    <form method="POST" id="post-form">
      {% csrf_token %}
      <div class="form-group">
        <label for="exampleInputEmail1">Publish Date</label>
        <input type="text" class="form-control" id="price" placeholder="price"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
      <a href="/auction">Back to auction</a>
    </form>
  </div>

</body>

<script>
  $(document).on('submit', '#post-form', function (e) {
    e.preventDefault();
    var url = window.location.pathname;
    var pk = url.substring(url.lastIndexOf('/') + 1);
    $.ajax({
      type: 'POST',
      url: "http://127.0.0.1:8000/put3/" + pk,
      data: {
        price: $('#price').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post'
      },
      success: function (json) {
        document.getElementById("post-form").reset();
        window.location.href("/auction");
      },
      error: function (xhr, errmsg, err) {
        $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: " + errmsg +
          " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
        console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
      }
    });
  });
</script>

{% endblock %}
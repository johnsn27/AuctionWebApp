{% extends 'base.html' %}

{% block content %}
<h1>Search</h1>
<form id='searchForm'>
  {% csrf_token %}
  <input name='query' type='text' placeholder='Search'/>
  <button id="searchBtn" type="button">
    Search
  </button>
</form>
<ul id="itemList">
</ul>
<script>
$(() => {
  const createListItem = (data) => {
    const {title} = data;
    const formattedDate = Date(data.endDate);
    return `<li class="media"><img src="media/${data.picture}" alt="${title}" class="img-thumbnail w-25"/><div class="media-body"><h2>${title}</h2>${data.description}<p>Ends: ${formattedDate}</p></div></li>`;
  };
  // Disable enter submitting form
  $(document).on("keydown", "form", (event) => { 
    return event.key != "Enter";
  });
  $("#searchBtn").click(() => {
    $.ajax({
        url: "{% url 'auctionsiteapp:itemsjson' %}",
        data: $("#searchForm").serializeArray(),
        success: (data) => {
          $("#itemList").empty();
          for (let i=0; i<data.items.length; i++) {
            const item = data.items[i];
            $("#itemList").append(createListItem(item));
          }
        }
    });
  });
})
</script>
{% endblock %}